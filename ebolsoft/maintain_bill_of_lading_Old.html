<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <!-- Meta, title, CSS, favicons, etc. -->
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Bill of Lading Processing </title>
  <link rel="icon" href="./img/app_icon.ico">

  <!-- Bootstrap -->
  <!--    <link href="./vendors/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
  -->
  <!-- Font Awesome -->
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.4/css/bootstrap-select.min.css">
  <!-- Font Awesome -->
  <link href="./vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet">
  <!-- NProgress -->
  <link href="./vendors/nprogress/nprogress.css" rel="stylesheet">

  <!-- iCheck -->
  <link href="./vendors/iCheck/skins/flat/green.css" rel="stylesheet">
  <!-- bootstrap-daterangepicker -->
  <link href="./css/datepicker.min.css" rel="stylesheet">

  <link rel="stylesheet" href="./dist/css/bootstrapValidator.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.1/bootstrap-table.min.css" />
  <link href="//cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css" rel="stylesheet">

  <link href="./css/bootstrap-editable.css" rel="stylesheet" />


  <!-- Custom Theme Style -->
  <link href="./build/css/custom.css" rel="stylesheet">
  <style>
    .nav-tabs>li.active>a,
    .nav-tabs>li.active>a:hover {
      box-shadow: inset 0 0 0 0 rgba(0, 0, 0, .4), -2px -3px 5px -2px rgba(0, 0, 0, .4);
    }

    .address-width {
      max-width: 200px;
      overflow: hidden;
      white-space: nowrap;
    }

    .text-on-pannel {
  background: #fff none repeat scroll 0 0;
  height: auto;
  margin-left: 10px;
  padding: 3px 5px;
  position: absolute;
  margin-top: -27px;
  border: 1px solid #337ab7;
  border-radius: 8px;
}

.panel {
  /* for text on pannel */
  margin-top: 27px !important;
}

.panel-body {
  padding-top: 10px !important;
}

  </style>
</head>

<body class="nav-md">
  <div class="container body">
    <div class="main_container">
      <div class="col-md-3 left_col">
        <div class="left_col scroll-view">
          <div class="navbar nav_title" style="border: 0;">
            <a href="index.html" class="site_title">
              <img src="./img/company_icon.ico" />
              <span id=glo_company_name></span>
            </a>
          </div>

          <div class="clearfix"></div>

          <!-- menu profile quick info -->
          <div class="profile clearfix">
            <div class="profile_pic">
              <img src="images/img.jpg" alt="..." class="img-circle profile_img">
            </div>
            <div class="profile_info">
              <span>Welcome,</span>
              <h2 class="user_fullname_disaplay">Active User</h2>
            </div>
          </div>
          <!-- /menu profile quick info -->

          <br />

          <!-- sidebar menu -->
          <div id="sidebar-menu" class="main_menu_side hidden-print main_menu">
            <div class="menu_section">
              <h3>General</h3>
              <ul class="nav side-menu">
                <li>
                  <a>
                    <i class="fa fa-home"></i> Home
                    <span class="fa fa-chevron-down"></span>
                  </a>
                  <ul class="nav child_menu">
                    <li>
                      <a href="/home/main">Dashboard</a>
                    </li>
                  </ul>
                </li>
                <li>
                  <a>
                    <i class="fa fa-cogs"></i> Maintenance
                    <span class="fa fa-chevron-down"></span>
                  </a>
                  <ul class="nav child_menu">
                    <li>
                      <a href="maintain_vessel.html">Vessel</a>
                    </li>
                    <li>
                      <a href="maintain_port.html">Port</a>
                    </li>
                    <li>
                      <a href="maintain_country.html">Country</a>
                    </li>
                    <li>
                      <a href="maintain_currency.html">Currency</a>
                    </li>
                    <li>
                      <a href="maintain_package.html">Package</a>
                    </li>
                    <li>
                      <a href="maintain_commodity.html">Commodity</a>
                    </li>
                    <li>
                      <a href="maintain_container_size_type.html">Container Size Type</a>
                    </li>
                  </ul>
                </li>
                <li>
                  <a>
                    <i class="fa fa-list-alt"></i> Charges
                    <span class="fa fa-chevron-down"></span>
                  </a>
                  <ul class="nav child_menu">
                    <li>
                      <a href="maintain_charges.html">Charge Item</a>
                    </li>
                    <li>
                      <a href="maintain_sur_charge.html">Sur Charge</a>
                    </li>
                    <li>
                      <a href="maintain_gct_rate.html">GCT Rate</a>
                    </li>
                  </ul>
                </li>
                <li>
                  <a>
                    <i class="fa fa-dollar"></i> Billing
                    <span class="fa fa-chevron-down"></span>
                  </a>
                  <ul class="nav child_menu">
                    <li>
                      <a href="maintain_receipt.html">Receipt</a>
                    </li>
                    <li>
                      <a href="maintain_order.html">Order</a>
                    </li>
                  </ul>
                </li>
                <li>
                  <a>
                    <i class="fa fa-anchor"></i> Manifest Processing
                    <span class="fa fa-chevron-down"></span>
                  </a>
                  <ul class="nav child_menu">
                    <li>
                      <a href="maintain_voyage.html">Voyage</a>
                    </li>
                    <li>
                      <a href="maintain_bill_of_lading.html">Bill of Lading</a>
                    </li>
                    <li>
                      <a href="BillOfLading_Enquiry.html">Bill of Lading Inquiry</a>
                    </li>
                  </ul>
                </li>
                <li>
                  <a>
                    <i class="fa fa-bar-chart"></i> Reports
                    <span class="fa fa-chevron-down"></span>
                  </a>
                  <ul class="nav child_menu">
                    <li>
                      <a href="maintain_item_Report.html">Item Report (Freight)</a>
                    </li>
                    <li>
                      <a href="maintain_print_daily_receipt.html">Print Daily Receipt</a>
                    </li>
                    <li>
                      <a href="maintain_print_daily_order.html">Print Daily Order</a>
                    </li>
                    <li>
                      <a href="maintain_print_cancel_receipt.html">Print Cancel Receipt</a>
                    </li>
                    <li>
                      <a href="maintain_print_cancel_order.html">Print Cancel Order</a>
                    </li>
                    <li>
                      <a href="maintain_gct_report.html">GCT Report</a>
                    </li>
                  </ul>
                </li>
              </ul>
            </div>


          </div>
          <!-- /sidebar menu -->

          <!-- /menu footer buttons -->
          <div class="sidebar-footer hidden-small">
            <a data-toggle="tooltip" data-placement="top" title="Settings">
              <span class="glyphicon glyphicon-cog" aria-hidden="true"></span>
            </a>
            <a data-toggle="tooltip" data-placement="top" title="FullScreen">
              <span class="glyphicon glyphicon-fullscreen" aria-hidden="true"></span>
            </a>
            <a data-toggle="tooltip" data-placement="top" title="Lock">
              <span class="glyphicon glyphicon-eye-close" aria-hidden="true"></span>
            </a>
            <a data-toggle="tooltip" data-placement="top" title="Logout" href="javascript:authenticateUser()">
              <span class="glyphicon glyphicon-off" aria-hidden="true"></span>
            </a>
          </div>
          <!-- /menu footer buttons -->
        </div>
      </div>

      <!-- top navigation -->
      <div class="top_nav">
        <div class="nav_menu">
          <nav>
            <div class="nav toggle" style=" line-height: 12px;padding: 5px 5px;">
              <a id="menu_toggle">
                <i style="font-size:16px" class="fa fa-bars"></i>
              </a>
            </div>

            <ul class="nav navbar-nav navbar-left">
              <li class="">
                <a style=" line-height: 12px;padding: 5px 5px ;margin-top:2px" href="javascript:;" class="user-profile dropdown-toggle" data-toggle="dropdown"
                  aria-expanded="false">
                  <span style="font-size: 15px;font-weight:bold;color:#73879C;"> Bill Of Lading</span>
                </a>

              </li>

            </ul>

            <ul class="nav navbar-nav navbar-right">
              <li class="">
                <a style=" line-height: 12px;padding: 0px 0px;" href="javascript:;" class="user-profile dropdown-toggle" data-toggle="dropdown"
                  aria-expanded="false">
                  <img src="images/img.jpg" alt="">
                  <span class="user_fullname_disaplay">Active User</span>
                  <span class=" fa fa-angle-down"></span>
                </a>
                <ul class="dropdown-menu dropdown-usermenu pull-right">
                  <li>
                    <a href="javascript:;"> Profile</a>
                  </li>
                  <li>
                    <a href="javascript:passwordChangeRequest()">
                      <i class="fa fa-lock pull-right"></i> Change Password</a>

                    </a>
                  </li>
                  <li>
                    <a href="javascript:displayHelp();">Help</a>
                  </li>
                  <li>
                    <a href="javascript:authenticateUser()">
                      <i class="fa fa-sign-out pull-right"></i> Log Out</a>
                  </li>
                </ul>
              </li>

              <li role="presentation" class="dropdownx">
                <button type="button" class="btn btn-round btn-success btn-sm " onclick="loadShortCutOption(this)">
                  <i class="fa fa-search-plus"></i> BL Processing</button>

              </li>
            </ul>
          </nav>
        </div>
      </div>
      <!-- /top navigation -->

      <!-- page content -->
      <div class="loader"></div>
      <div class="right_col" role="main">


        <div class="">
          <div class="container">
            <div class="panel panel-primary">
              <div class="panel-body" >
                <h5 class="text-on-pannel text-primary"><strong class="text-uppercase "> Status </strong></h5>
                
                <div class="form-group col-sm-3">
                  <strong >Container Type: </strong>                 
                    <span class=" text-primary" id=container_size_description>00ft Container</span>
                </div>
                <div class="form-group col-sm-3">
                  <strong >Size Cubic Ft: </strong>                 
                    <span class=" text-primary" id=container_size>0.00</span>
                </div>
                <div class="cube-count form-group col-sm-3">
                  <strong >Space Remaining CFT: </strong>                 
                  <b>  <span style="color:brown" id=container_space>0.00</span></b>
                </div>
                <div class="form-group col-sm-3">
                  <strong >Number of Pieces: </strong>                 
                    <span  id="number_of_pieces">00</span>
                </div>
              
                <div class="form-group col-sm-6">
                  <span style="padding-right: 27px;">Tally Status: </span>                 
                    <span class=" text-primary" id=tally_status>0 Bls Tallied</span>
                </div>
                <div class="form-group col-sm-3">
                  <button type="button" class="btn btn-round btn-info btn-sm " onclick="viewTallyResults()">
                  <i class="fa fa-search-plus"></i>View Tally Results</button>
                 </div>
                
                 <div class="btn-group col-sm-3">
                  <button data-toggle="dropdown" class="btn btn-round btn-dark btn-sm dropdown-toggle" type="button"> 
                          <i class="fa fa-list-alt"></i> Print <span class="caret"></span> </button>
                  <ul class="dropdown-menu" id="form-list">
                    <li><a href="javascript:printManifest();">Manifest</a>
                    </li>
                    <li><a href="javascript:printManifestCharges();">Freight List</a>
                    </li>
                    <li class="hidden"><a href="javascript:printChargesManifest();">Charges Manifest</a>
                    </li>  
                    </li>                        
                  </ul>
                </div>

              </div>
            </div>
          </div>
          <div id="toolbar">
            <div class="form-inline" role="form">
              <div class="form-group">
                <a class="create btn btn-success" onclick="newBillOfLading()">Add New</a>
              </div>
              <div class="form-group">
                <label class="control-label col-md-3">Vessel</label>
              </div>
              <div class="form-group">
                <select id="vessel" onchange="loadBookingSelect()" data-live-search="true" class=" load-selectpicker  form-control" data-path="./app/vessel/select"></select>
              </div>
              <div class="form-group">
                <label class="control-label col-md-3">Booking</label>
              </div>
              <div class="form-group">
                <select id="booking" onchange="loadManifestTable()" class=" load-select form-control"></select>
              </div>
              <div class="form-group ">
                <label style="margin-left: 20px;" for="booking_container">Container</label>
                <select class=" load-select form-control" onchange="updateStatus()"  id="booking_container" ></select>
              </div>
             
         
             
            </div>
          </div>
          <table id="classTable" class="display" cellspacing="0" data-toolbar="#toolbar" data-query-params="queryParams" data-pagination="true"
            data-striped="true" data-search="true" data-show-multi-sort="true" data-sort-priority='[{"sortName": "name","sortOrder":"desc"},{"sortName":"location","sortOrder":"desc"}]'>
            <thead>
              <tr>
                <th data-field="id" data-sortable="true" data-visible="false">ID</th>
                <th data-field="parent_bol" data-sortable="true" data-visible="false">Master</th>
                <th data-field="bill_of_lading_number" data-sortable="true"> Bill Of Lading Number</th>
                <th data-field="consignee_fname" data-class="address-width"  data-sortable="true"> Consignee Name</th>
                <th data-field="consignee_sname" data-class="address-width"  data-sortable="true"> Consignee Name</th>
                <th data-field="consignee_address" data-class="address-width" data-sortable="true">Consignee Address</th>
                <th data-formatter="createBlActionButtons" data-searchable="false">Action</th>
              </tr>
            </thead>
            <tfoot>
              <tr>
                <th class="hidden">ID</th>
                <th class="hidden">Parent</th>
                <th> Bill Of Lading Number</th>
                <th>Consignee Name</th>
                <th>Consignee Name</th>
                <th>Consignee Address</th>
                <th>Action</th>
              </tr>
            </tfoot>
          </table>
        </div>
      </div>


      <!-- Bootstrap modal style="z-index:1041" -->
      <div class="modal fade" id="modal_form" role="dialog">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
              <h3 class="modal-title">Bill Of Lading Form</h3>
            </div>
            <div class="modal-body form">
              <form id="form" class="form-horizontal" data-toggle="validator">
                <input type="hidden" value="" id="id" />
                <div class="form-body">
                  <div class="row">
                    <div class="col-md-2 form-group">
                      <div class="checkbox" onclick="showHideParentBL()">
                        <label class="control-label ">Parent Bol
                          <input id="parent_bol" name="parent_bol" type="checkbox" class="flat">
                        </label>
                      </div>
                    </div>

                    <div class="form-group col-md-6">
                      <label class="control-label col-md-4">Bill Of Lading Number</label>
                      <div class="col-md-8">
                        <input id="bill_of_lading_number" name="bill_of_lading_number" placeholder="Bill Of Lading Number" class="form-control" type="text"
                          required>
                        <span class="help-block"></span>
                      </div>
                    </div>

                    <div id="masterbl" class="col-md-5 form-group">
                      <label class="control-label col-md-3">Master BL</label>
                      <div class="col-md-9">
                        <select id="master_bol_id" onchange="initializeWithMaster()" class=" form-control"></select>
                        <span class="help-block"></span>
                      </div>
                    </div>
                    <div id="mastercontainer" class="col-md-5 form-group">
                      <label class="control-label col-md-3">Container#</label>
                      <div class="col-md-9">
                        <select id="booking_container_id"  class=" form-control"></select>
                        <span class="help-block"></span>
                      </div>
                    </div>
                  
                </div>
                  <div class="container">
                    <ul class="nav nav-tabs">                     

                      <li role="presentation">
                        <a id="consigneetab" href="#consignee" data-toggle="tab" aria-controls="consignee" role="tab" title="Consignee">
                          <span class="round-tab">
                            <i class="fa fa-user" style="color:brown"></i>
                            Consignee
                          </span>
                        </a>
                      </li>
                      <li role="presentation">
                        <a id="shippertab" href="#shipper" data-toggle="tab" aria-controls="shipper" role="tab" title="Shipper">
                          <span class="round-tab">
                            <i class="fa fa-user" style="color:green"></i>
                            Shipper
                          </span>
                        </a>
                      </li>
                      <li role="presentation">
                        <a id="notifytab" href="#notify" data-toggle="tab" aria-controls="notify" role="tab" title="Notiyfy Party">
                          <span class="round-tab">
                            <i class="fa fa-user"></i>
                            Notify
                          </span>
                        </a>
                      </li>
                      <li role="presentation">
                        <a id="goodstab" href="#goods" data-toggle="tab" aria-controls="goods" role="tab" title="Goods">
                          <span class="round-tab">
                            <i class="fa fa-cubes"></i>
                            Goods
                          </span>
                        </a>
                      </li>
                      <li role="presentation">
                        <a id="chargestab" href="#charges" data-toggle="tab" aria-controls="charges" role="tab" title="Charges">
                          <span class="round-tab">
                            <i class="fa fa-list-alt"></i>
                            Charges
                          </span>
                        </a>
                      </li>
                      <li role="presentation">
                        <a id="containertab" href="#container" data-toggle="tab" aria-controls="container" role="tab" title="Container">
                          <span class="round-tab">
                            <i class="fa fa-tasks"></i>
                            Container
                          </span>
                        </a>
                      </li>
                    </ul>


                    <div class="tab-content">
                   

                      <div class="tab-pane" role="tabpanel" id="consignee">
                        <div class="form-group "> <label
                          class="control-label col-md-3">Customer</label>
                          <div class="col-md-9">
                              <select id="consignee_id" onchange="initializeConsignee()"
                                  data-live-search="true"
                                  class="add-none load-selectpicker  form-control"
                                  data-path="./app/client/select"></select>
                              <span class="help-block"></span> </div>
                       </div>
                        <div class="form-group">
                          <div class="col-md-6">
                          <label class="control-label col-md-3">First Name</label>
                          <div class="col-md-9">
                            <input id="consignee_fname" name="consignee_fname" placeholder="First Name" class="form-control" type="text">
                            <span class="help-block"></span>
                          </div>
                        </div>
                        <div class="col-md-6">
                          <label class="control-label col-md-3">Last Name</label>
                          <div class="col-md-9">
                            <input id="consignee_sname" name="consignee_sname" placeholder="Last Name" class="form-control" type="text">
                            <span class="help-block"></span>
                          </div>
                        </div></div>
                        <div class="form-group">  <label class="control-label col-md-3">Consignee Other Names</label><div class="col-md-9"> <input id="consignee_other_name" name="consignee_other_name" placeholder="Consignee Other Names" class="form-control" type="text" ><span class="help-block"></span> </div> </div>
                        <div class="form-group">
                          <label class="control-label col-md-3">Consignee Address</label>
                          <div class="col-md-9">
                            <input id="consignee_address" name="consignee_address" placeholder="Consignee Address" class="form-control" type="text">
                            <span class="help-block"></span>
                          </div>
                        </div>
                        <div class="form-group ">
                          <label class="control-label col-md-3">Consignee Phone #</label>
                          <div class="col-md-9">
                            <input id="consignee_phone_num" placeholder="000-000-0000" class="form-control" type="text">
                            <span class="help-block"></span>
                          </div>
                        </div>
                        <div class="form-group hidden">
                          <label class="control-label col-md-3">Consignee Id</label>
                          <div class="col-md-9">
                            <input id="consignee_id" name="consignee_id" placeholder="Consignee Id" class="form-control" type="text">
                            <span class="help-block"></span>
                          </div>
                        </div>
                        <div class="form-group" id=cusstype>                               
                          <label class="control-label col-md-3">Customer Type</label>
                          <div class="col-sm-9">
                            <select id="customer_type" class="selectpicker " data-width="auto" required>
                              <option value="">Regular</option>
                              <option value="doortodoor">DoorToDoor</option>
                              <option value="preclear">PreClear</option>
                              <option value="localpreclear">LocalPreClear</option>
                              <option value="doortodoor">DoorToDoor</option>     
                            </select>
                            <span class="help-block"></span>
                          </div>
                        </div>

                      </div>
                      <div class="tab-pane" role="tabpanel" id="shipper">
                        <div class="form-group "> <label
                          class="control-label col-md-3">Customer</label>
                          <div class="col-md-9">
                              <select id="shipper_id" onchange="initializeShipper()"
                                  data-live-search="true"
                                  class="add-none load-selectpicker  form-control"
                                  data-path="./app/client/select"></select>
                              <span class="help-block"></span> </div>
                       </div>
                        <div class="form-group">
                          <div class="col-md-6">
                          <label class="control-label col-md-3">First Name</label>
                          <div class="col-md-9">
                            <input id="shipper_fname" name="shipper_fname" placeholder="First Name" class="form-control" type="text">
                            <span class="help-block"></span>
                          </div>
                        </div>
                        <div class="col-md-6">
                          <label class="control-label col-md-3">Last Name</label>
                          <div class="col-md-9">
                            <input id="shipper_sname" name="shipper_sname" placeholder="Last Name" class="form-control" type="text">
                            <span class="help-block"></span>
                          </div>
                        </div></div>
                        <div class="form-group">  <label class="control-label col-md-3">Shipper Other Names</label><div class="col-md-9"> <input id="shipper_other_name" name="shipper_other_name" placeholder="Shipper Other Names" class="form-control" type="text" ><span class="help-block"></span> </div> </div>
                        <div class="form-group">
                          <label class="control-label col-md-3">Shipper Address</label>
                          <div class="col-md-9">
                            <input id="shipper_address" name="shipper_address" placeholder="Shipper Address" class="form-control" type="text">
                            <span class="help-block"></span>
                          </div>
                        </div>

                        <div class="form-group ">
                          <label class="control-label col-md-3">Shipper Phone #</label>
                          <div class="col-md-9">
                            <input id="shipper_phone_num" placeholder="000-000-0000" class="form-control" type="text">
                            <span class="help-block"></span>
                          </div>
                        </div>
                      </div>
                      <div class="tab-pane" role="tabpanel" id="notify">

                     
                          <div class="control-label col-md-3"></div>
                          <div class="control-label col-md-9">
                            <button id="same_csn" class="btn btn-warning btn-sm">Same as Consignee</button>
                          </div>
                          <div class="form-group">
                            <div class="col-md-6">
                          <label class="control-label col-md-3"> First Name</label>
                          <div class="col-md-9">
                            <input id="notify_fname" name="notify_fname" placeholder="First Name" class="form-control" type="text">
                            <span class="help-block"></span>
                          </div>
                        </div>
                        <div class="col-md-6">
                          <label class="control-label col-md-3"> Last Name</label>
                          <div class="col-md-9">
                            <input id="notify_sname" name="notify_sname" placeholder="Last Name" class="form-control" type="text">
                            <span class="help-block"></span>
                          </div>
                        </div></div>
                        <div class="form-group">  <label class="control-label col-md-3">Notify Other Names</label><div class="col-md-9"> <input id="notify_other_name" name="notify_other_name" placeholder="Notify Other Names" class="form-control" type="text" ><span class="help-block"></span> </div> </div>
                        <div class="form-group">
                          <label class="control-label col-md-3">Notify Address</label>
                          <div class="col-md-9">
                            <input id="notify_address" name="notify_address" placeholder="Notify Address" class="form-control" type="text">
                            <span class="help-block"></span>
                          </div>
                        </div>
                        <div class="form-group ">
                          <label class="control-label col-md-3">Notify Phone #</label>
                          <div class="col-md-9">
                            <input id="notify_phone_num" placeholder="000-000-0000" class="form-control" type="text">
                            <span class="help-block"></span>
                          </div>
                        </div>

                        <div class="form-group hidden">
                          <label class="control-label col-md-3">Notify Date</label>
                          <div class="col-md-9">
                            <input data-toggle="datepicker" id="notify_date" name="notify_date" placeholder="Notify Date" class="form-control has-feedback-left"
                              type="text">
                            <span class="fa fa-calendar form-control-feedback left" aria-hidden="true"></span>
                            <span class="help-block"></span>
                          </div>
                        </div>
                      </div>
                      <div class="tab-pane" role="tabpanel" id="goods">
                        <div class="">

                          <p class="toolbar">
                            <button type="button" id="create-detail" class="btn btn-success btn-sm">Add New</button>
                          </p>
                          <table id="blDetailTable" class="display" cellspacing="0" data-toolbar=".toolbar" data-query-params="queryParams" data-pagination="true"
                            data-striped="true" data-search="true" data-show-multi-sort="true" data-sort-priority='[{"sortName": "name","sortOrder":"desc"},{"sortName":"location","sortOrder":"desc"}]'>
                            <thead>
                              <tr>
                                <th data-field="id" data-sortable="true" data-visible="false">ID</th>
                                <th data-field="Description_of_goods" data-sortable="true">Description</th>
                                <th data-formatter="createActionButtons" data-searchable="false">Action</th>
                              </tr>
                            </thead>
                            <tfoot>
                              <tr>
                                <th class="hidden">ID</th>
                                <th>Description</th>
                                <th>Action</th>
                              </tr>
                            </tfoot>
                          </table>
                        </div>

                      </div>
                      <div class="tab-pane" role="tabpanel" id="charges">
                   
                        <div class="">
                          <p class="chargetoolbar">
                            <button type="button" id="create-charge-rec" class="btn btn-success btn-sm">Add New</button>
                          </p>
                          <table id="chargeTable" class="display" cellspacing="0" data-toolbar=".chargetoolbar" data-query-params="queryParams" data-pagination="true"
                            data-striped="true" data-search="true" data-show-multi-sort="true">
                            <thead>
                              <tr>
                                <th data-field="id" data-visible="false">ID</th>
                                <th data-field="charge_item_id" data-formatter="formatChargeItem" data-sortable="true">Charge Item </th>                                
                                <th data-field="amount" data-sortable="true">Amount</th>
                                <th data-field="amount_paid" data-sortable="true">Amount Paid</th>
                                <th data-field="amount" data-formatter="formatBalance" data-sortable="true">Balance </th>                                
                                <th data-formatter="createChargeActionButtons" data-searchable="false">Action</th>
                              </tr>
                            </thead>
                            
                          </table>
                        </div>

                      </div>
                      <div class="tab-pane" role="tabpanel" id="container">
                        <h3>Container</h3>
                        <div class="">
                          <p class="toolbarcon ">

                            <div style="margin-top:3px;">
                              <button type="button" onclick="addBOLContainer()" class="btn btn-success btn-sm">Add Container</button>
                            </div>
                          </p>
                          <table id="containertable" class="display" cellspacing="0" data-toolbar=".toolbarcon" data-pagination="true" data-striped="true"
                            data-editable="true" data-toolbar-align='top' data-search="false" data-show-multi-sort="true" data-sort-priority='[{"sortName": "voyage_number","sortOrder":"desc"},{"sortName":"id","sortOrder":"desc"}]'>

                          </table>
                        </div>
                      </div>

                    </div>



                    <div class="modal-footer">
                      <ul class="list-inline pull-right">
                        <li>
                          <input id="submit" type="submit" class="btn btn-info" value="Save" onclick="saveRecord()">
                        </li>
                        <li>
                          <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                        </li>
                      </ul>
                    </div>

                  </div>
                </div>
              </form>
            </div>

          </div>
          <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
      </div>

      <!-- /.modal -->
      <!-- End Bootstrap modal -->


      <!-- Bootstrap BL DETAIL modal -->
      <div class="modal" id="detail_modal" data-backdrop="static" style="z-index:1149">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
              <h4 class="modal-title">Second Modal title</h4>
            </div>
            <div class="container"></div>
            <div class="modal-body">
              <form id="bl_Detail_form" class="form-horizontal" data-toggle="validator">
                <div class="form-body">
                  <input type="hidden" value="form body" id="id" />
                  <input type="hidden" value="form body" id="billoflading_id" />
                  <div class="form-group">
                    <label class="control-label col-md-3">Number Of Items</label>
                    <div class="col-md-5">
                      <input onchange="autoDescribeGoods()" type="number" min="0" step="1" id="number_of_items" name="number_of_items" placeholder="Number Of Items"
                        class="form-control" type="text" required>
                      <span class="help-block"></span>
                    </div>
                    <div class="checkbox col-md-3">
                      <label class="control-label " onclick="autoDescribeGoods(1)">Auto Describe
                        <input id="auto_describe" type="checkbox" class="flat">
                      </label>
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="control-label col-md-3">Package Type </label>
                    <div class="col-md-9">
                      <select id="package_type_id" onchange="autoDescribeGoods()" class=" load-selectpicker form-control" data-live-search="true"
                        data-path="./app/package/select" required>
                      </select>
                      <span class="help-block"></span>
                    </div>
                  </div>

                  <div class="form-group">
                    <label class="control-label col-md-3">Commodity</label>
                    <div class="col-md-9">
                      <select id="commodity_id" onchange="autoDescribeGoods()" class=" load-selectpicker form-control" data-path="./app/commodity/select"></select>
                      <span class="help-block"></span>
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="control-label col-md-3">Description of Goods</label>
                    <div class="col-md-9">
                      <textarea id="Description_of_goods" class=" form-control"></textarea>
                      <span class="help-block"></span>
                    </div>
                  </div>

                  <div class="form-group">
                    <label class="control-label col-md-3">Weight</label>
                    <div class="col-md-3">
                      <input id="weight" name="weight" placeholder="Weight" class="form-control" type="number" min="0" step=".01" required>
                      <span class="help-block"></span>
                    </div>

                    <label class="control-label col-md-3">Weight Unit</label>
                    <div class="col-md-3">
                      <select id="weight_unit" class="selectpicker " data-width="auto" required>
                        
                        <option value="lb">Pounds</option>
                        <option value="kg">Kilograms</option>
                      </select>
                      <span class="help-block"></span>
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="control-label col-md-3">Measure</label>
                    <div class="col-md-3">
                      <input id="measure" name="measure" placeholder="Measure" class="form-control" type="number" min="0" step=".01" required>
                      <span class="help-block"></span>
                    </div>

                    <label class="control-label col-md-3">Measure Unit</label>
                    <div class="col-sm-3">
                      <select id="measure_unit" class="selectpicker " data-width="auto" required>
                        <option value="cuf">Cubic Feet</option>
                        <option value="cum">Cubic Meter</option>
                      </select>
                      <span class="help-block"></span>
                    </div>
                  </div>
                  <fieldset style="display:none;">
                    <legend style="font-size:12px;">Measurement</legend>
                    <div class="form-group">
                      <label class="control-label col-md-3">Width</label>
                      <div class="col-md-3">
                        <input id="width" name="width" placeholder="Width" class="form-control" type="number" min="0" step=".01">
                        <span class="help-block"></span>
                      </div>

                      <label class="control-label col-md-3">Depth</label>
                      <div class="col-md-3">
                        <input id="depth" name="depth" placeholder="Depth" class="form-control" type="number" min="0" step=".01">
                        <span class="help-block"></span>
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="control-label col-md-3">Breath</label>
                      <div class="col-md-3">
                        <input id="breath" name="breath" placeholder="Breath" class="form-control" type="number" min="0" step=".01">
                        <span class="help-block"></span>
                      </div>

                      <label class="control-label col-md-3">Volume</label>
                      <div class="col-md-3">
                        <input id="volume" name="volume" placeholder="Volume" class="form-control" type="number" min="0" step=".01">
                        <span class="help-block"></span>
                      </div>
                    </div>
                  </fieldset>
                </div>
                <div class="modal-footer">
                  <input id="submit" type="submit" class="btn btn-info" value="Save" onclick="saveRecord()">
                  <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
                </div>
              </form>
            </div>

          </div>
          <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
      </div>
      <!-- /.modal -->
      <!-- End Bootstrap  BL DETAIL  modal -->

      <!-- Bootstrap modal -->
      <div class="modal fade" id="apply_charges_modal" role="dialog">
        <div class="modal-dialog modal-md">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
              <h3 class="modal-title">Apply Charges</h3>
            </div>
            <div class="modal-body form">
              <label class="control-label ">Charge Item </label>

              <select id="apply_charge_item_id" class="load-select selectpicker" data-path="./app/charge_item/select" required></select>
              <button class=" btn btn-success" onclick="applyCharges()" id="apply_charges_but">Apply</button>
              <button class=" btn btn-danger" onclick="removeCharges()" id="remove_charges_but">Remove</button>
            </div>
          </div>
          <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
      </div>

 <!-- Bootstrap modal -->
 <div class="modal fade" id="tally_modal" role="dialog">
  <div class="modal-dialog">
      <div class="modal-content">
          <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
              <h3 class="modal-title">Tally Results</h3>
          </div>
          <div class="modal-body form">
              <form id="tally_result_form" class="form-horizontal" data-toggle="validator">
                  
                  <div class="form-body"> 
                    <div id="tallyviewbar">
                      <div class="col-md-12">
                      <label class=" control-label " onclick="showHideTallyErrors()">
                      <input id="show_tally_errors"  type="checkbox" data-toggle="toggle" >
                      Show Errors Only
                      </label>   
                      <span style="margin-left: 15px;" id=tally_error_count>0 Errors </span>
                    </div>
                  
                  </div>
                    <table id="tallyResultTable" class="display" cellspacing="0" data-toolbar="#tallyviewbar" data-query-params="queryParams" data-pagination="true"
                    data-striped="true" data-search="true" data-show-multi-sort="true" >
                  </table>
</div><div class="modal-footer">
                     
                  </div>
              </form>
          </div>

      </div>
      <!-- /.modal-content -->
  </div>
  <!-- /.modal-dialog -->
</div>
<!-- /.modal -->
<!-- End Bootstrap modal -->

      <!-- Bootstrap BL CHARGE modal -->
      <div class="modal fade" id="charge_modal" role="dialog">
        <div class="modal-dialog ">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
              <h3 class="modal-title">Bill Of Lading Other Charge Form</h3>
            </div>
            <div class="modal-body form">
              <form id="charge_form" class="form-horizontal" data-toggle="validator">
                <input type="hidden" name="id" id="id" />
                <input type="hidden" id="billoflading_id" />

                <div class="form-body">
                  <div class="form-group">
                    <label class="control-label col-md-3">Charge Item </label>
                    <div class="col-md-9">
                      <select onchange="initialLizeAmount()" id="charge_item_id" class="load-select selectpicker" data-path="./app/charge_item/select"
                        required></select>
                      <span class="help-block"></span>
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="control-label col-md-3">Amount</label>
                    <div class="col-md-4">
                      <input id="amount" name="amount" placeholder="Amount" class="form-control" type="number" min="0" step=".01" required>
                      <span class="help-block"></span>
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="control-label col-md-3">Amount Paid</label>
                    <div class="col-md-4">
                      <input id="amount_paid" name="amount_paid" placeholder="Amount Paid" class="form-control" type="number" min="0" step=".01" >
                      <span class="help-block"></span>
                    </div>
                  </div>
                  <div class="form-group hidden">
                    <label class="control-label col-md-3">Prepaid Flag</label>
                    <div class="col-md-9">
                      <select id="prepaid_flag" class="selectpicker ">
                        <option value="c">Collect</option>
                        <option value="p">Prepaid</option>
                        <option value="i">Ignore</option>
                      </select>
                      <span class="help-block"></span>
                    </div>
                  </div>
                  <div class="form-group hidden">
                    <div class="checkbox ">
                      <label class="control-label">Attracts GCT
                        <input id="attract_gct" type="checkbox" class="flat">
                      </label>
                    </div>
                  </div>
                  <div class="form-group hidden">
                    <label class="control-label col-md-3">Payment Currency</label>
                    <div class="col-md-9">
                      <select id="currency_id" class="load-select selectpicker" data-path="./app/currency/select" required></select>
                      <span class="help-block"></span>
                    </div>
                  </div>

                </div>
                <div class="modal-footer">
                  <input id="submit" type="submit" class="btn btn-info" value="Save" onclick="saveRecord()">
                  <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
                </div>
              </form>
            </div>

          </div>
          <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
      </div>
      <!-- /page content -->

    </div>
  </div>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
  <script src="//code.jquery.com/ui/1.11.2/jquery-ui.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.1/bootstrap-table.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.4/js/bootstrap-select.min.js"></script>
  <script src="./js/ajax-bootstrap-select.min.js"></script>
  <script src="./vendors/fastclick/lib/fastclick.js"></script>
  <!-- NProgress -->
  <script src="./vendors/nprogress/nprogress.js"></script>

  <script src="./js/bootstrap-editable.js"></script>
  <!-- iCheck -->
  <script src="./js/bootstrap-table-editable.js"></script>
  <script src="./vendors/iCheck/icheck.min.js"></script>
  <!-- bootstrap-daterangepicker -->
  <script src="./js/datepicker.min.js"></script>

  <script type="text/javascript" src="./dist/js/bootstrapValidator.js"></script>
  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>

  <!-- Custom Theme Scripts -->
  <script src="./build/js/custom.min.js"></script>

  <script src="./scripts/app.js"></script>
  <script src="./scripts/crud.js"></script>
  <script>
    function applySpecificCharge(){
      $('#apply_charges_modal').modal('show');
    }
    function generateCharges(){
      $('.loader').show();
      $.ajax({
        type: "POST",
        url: './app/billoflading/generate_charge/' + $('#booking').val(),
        success: function (data) {
          $('.loader').hide();
          $('#apply_charges_modal').modal('hide');
          toastr.success('Charges added ' + data + ' bills of lading', 'Success Alert', { timeOut: 5000 });
        },
        error: function (xhr, ajaxOptions, thrownError) { $('.loader').hide(); handleStandardHttpErrors(xhr, ajaxOptions, thrownError); },
        beforeSend: function (xhr, settings) { xhr.setRequestHeader('Authorization', 'Bearer ' + token); }
      });
    }

    $("#same_csn").click(function (e) {
      e.preventDefault();
      $('#notify_fname').val($('#consignee_fname').val());
      $('#notify_sname').val($('#consignee_sname').val());
      $('#notify_address').val($('#consignee_address').val());
      $('#notify_phone_num').val($('#consignee_phone_num').val());
    });
    function initialLizeAmount() {
      var select_path = "./app/charge_item/select";
      if (SELECT_DATA_PATH[select_path]) {
        var data = getJsonObjectValue(SELECT_DATA_PATH[select_path], 'id', $('#charge_item_id').val());

$('#currency_id').val(data[0].currency_id);
        //if (data.basis=='fixed'){   TBC
        $('#attract_gct').iCheck('uncheck');
        $('#attract_gct').prop('checked', false);
        if (data[0].gct == 1) {
          $('#attract_gct').iCheck('check');
          $('#attract_gct').prop('checked', true);
        }
        $('#amount').val(data[0].item_rate);
        //}
      }
    }

    function applyCharges() {
      $('.loader').show();
      $.ajax({
        type: "POST",
        url: './app/billoflading/apply_charge/' + $('#booking').val() + '/' + $('#apply_charge_item_id').val(),
        success: function (data) {
          $('.loader').hide();
          $('#apply_charges_modal').modal('hide');
          toastr.success('Charge was successfully applied to ' + data + ' bills of lading', 'Success Alert', { timeOut: 5000 });
        },
        error: function (xhr, ajaxOptions, thrownError) { $('.loader').hide(); handleStandardHttpErrors(xhr, ajaxOptions, thrownError); },
        beforeSend: function (xhr, settings) { xhr.setRequestHeader('Authorization', 'Bearer ' + token); }
      });

    }
    function removeCharges() {
      $('.loader').show();
      $.ajax({
        type: "POST",
        url: './app/billoflading/unapply_charge/' + $('#booking').val() + '/' + $('#apply_charge_item_id').val(),
        success: function (data) {
          $('.loader').hide();
          $('#apply_charges_modal').modal('hide');
          toastr.success('Charge was successfully removed from ' + data + ' bills of lading', 'Success Alert', { timeOut: 5000 });
        },
        error: function (xhr, ajaxOptions, thrownError) { $('.loader').hide(); handleStandardHttpErrors(xhr, ajaxOptions, thrownError); },
        beforeSend: function (xhr, settings) { xhr.setRequestHeader('Authorization', 'Bearer ' + token); }
      });
    }

    $(document).ready(function () {
             
      setInterval(updateStatus, 30000);
      //data_model = { "id": "0", "parent_bol": "", "bol_total": "", "bill_of_lading_number": "", "port_of_origin": "", "port_of_loading": "", "port_of_discharge": "", "port_of_delivery": "", "currency_id": "", "consignee_name": "", "consignee_address": "", "consignee_phone_num": "", "consignee_id": "", "shipper_name": "", "shipper_address": "", "shipper_phone_num": "", "notify_name": "", "notify_address": "", "notify_date": "", "notify_phone_num": "", "master_bol_id": "", "voyage_id": "", "value_currency":"","value_of_goods":""};
      data_model={ "id": "0","parent_bol": "","bol_total": "","bill_of_lading_number": "","port_of_origin": "","port_of_loading": "","port_of_discharge": "","port_of_delivery": "","currency_id": "","consignee_sname": "","consignee_fname": "","consignee_other_name": "","consignee_address": "","consignee_phone_num": "","consignee_id": "","shipper_id": "","shipper_fname": "","shipper_sname": "","shipper_other_name": "","shipper_address": "","shipper_phone_num": "","notify_fname": "","notify_other_name": "","notify_sname": "","notify_address": "","notify_date": "","notify_phone_num": "","master_bol_id": "","booking_id": "","order_processed": "","receipt_processed": "","edited_by": "","edit_type": "","value_of_goods": "","value_currency": "","customer_type": "","status": "","booking_container_id": ""};
      save_method = '';
      pkey = 'id';

      //&**************************************************
      $( ".modal" ).each(function() {
        $( this ).draggable({
           handle: ".modal-header"
         });
      });

      $('#form')
        .bootstrapValidator({
          feedbackIcons: {
            valid: 'glyphicon glyphicon-ok',
            invalid: 'glyphicon glyphicon-remove',
            validating: 'glyphicon glyphicon-refresh'
          },
          excluded: [':disabled'],
          fields: {
            port_origin: {
              validators: {
                notEmpty: {
                  message: 'Port of origin  required and cannot be empty'
                }
              }
            },
            port_delivery: {
              validators: {
                notEmpty: {
                  message: 'Port of delivery is  required and cannot be empty'
                }
              }
            },
            bill_of_lading_number: {
              validators: {
                notEmpty: {
                  message: 'Bill Of Lading Number is  required and cannot be empty'
                }
              }
            }
          }
        }).on('error.form.bv', function (e) {
          var tab = $(".has-error:first input").closest('.tab-pane').attr('id');
          $('.nav-tabs a[href="#' + tab + '"]').tab('show');
          $(".has-error:first input").focus();
          e.preventDefault();
        })
        .on('success.form.bv', function (e) {
          // Prevent submit form
          e.preventDefault();
          var $form = $(e.target),
            validator = $form.data('bootstrapValidator');
          var form_data = getFormData('#form', data_model);
          form_data['booking_id'] = $('#booking').val();
          form_data['notify_date'] = validDate($('#notify_date').val()).date;
          console.log(form_data);
          if (save_method == 'PUT') {
            $.ajax({
              type: "PUT",
              url: './app/bill_of_lading/' + form_data['id'],
              data: JSON.stringify(form_data),
              success: function (data) {
                $('#modal_form').modal('hide');
                toastr.success('The record was updated successfully', 'Success Alert', { timeOut: 5000 })
                $('#classTable').bootstrapTable('updateByUniqueId', {
                  id: form_data['id'],
                  row: form_data
                });
                updateHouse(form_data['id']);
              },
              error: function (xhr, ajaxOptions, thrownError) { handleStandardHttpErrors(xhr, ajaxOptions, thrownError) },
              beforeSend: function (xhr, settings) { xhr.setRequestHeader('Authorization', 'Bearer ' + token); }
            });
          }
          if (save_method == 'POST') {
            form_data.id = null;
            form_data.edited_by= parseJwt().id;
            $.ajax({
              type: "POST",
              url: './app/bill_of_lading/',
              data: JSON.stringify(form_data),
              success: function (data) {
                var obj = {};
                $.extend(true, obj, form_data);
                obj.id = data;
                if (form_data.parent_bol == 1) { loadParentSelect('new'); }
                editThis(data, '');
                toastr.success('The record was successfully added', 'Success Alert', { timeOut: 5000 });
                $('#classTable').bootstrapTable("append", obj);

              },
              error: function (xhr, ajaxOptions, thrownError) { handleStandardHttpErrors(xhr, ajaxOptions, thrownError) },
              beforeSend: function (xhr, settings) { xhr.setRequestHeader('Authorization', 'Bearer ' + token); }
            });
          }
          $form
            .bootstrapValidator('disableSubmitButtons', false)
            .bootstrapValidator('resetForm', true);
        })
        .on('click', 'tbody > tr > td', function (e) {

        });

      //**************************************************

      loadBookingSelect();

      function getData() {
        return '{"data":[{"id":"1","name":"1 West","location":"Block C"},{"id":"2","name":"1 North","location":"Block A"},{"id":"3","name":"1 South","location":"Block A"}]}';
      }

      $('#parent_bol').on('ifChanged', function (event) {
        showHideParentBL();
      });


    });
    function saveRecord() {

    }
    function printAllBillofLading(){
      showLargeReport('./app/report/billoflading_f1/All/'  +$('#booking').val() , 'bill_of_ladings.pdf', 'Bill Of Lading', '#my-report1-iframe', {});
      $('#report2-tab').hide();
    }
    function printThis(id, el) {
      var obj= getRowWithId(id);
      var path='./app/report/billoflading_f1/' + id ;
      if(obj.parent_bol==1){  path='./app/report/master_billoflading/' + id   }
      showLargeReport(path , 'bill_of_lading.pdf', 'Bill Of Lading', '#my-report1-iframe', {});      
      $('#report2-tab').hide();
    }
    function deleteThis(id, el) {
      var tmp = $(el).closest("tr").find("td:eq(0)").text();
      confirmDialog("Delete Request", 'Are you sure you want to delete:<br><b>' + tmp + '<b> ?', function (confirm) {
        if (!confirm) return false;
        $.ajax({
          type: "DELETE",
          url: './app/bill_of_lading/' + id,
          success: function (data) {
            console.log('deleted ' + id);
            //$('#classTable').bootstrapTable('remove', { field: 'id', values: ['' + id] });
            $('#classTable').bootstrapTable('removeByUniqueId', id);
            toastr.success('The record was deleted successfully', 'Success Alert', { timeOut: 5000 })

          },
          error: function (xhr, ajaxOptions, thrownError) { handleStandardHttpErrors(xhr, ajaxOptions, thrownError) },
          beforeSend: function (xhr, settings) { xhr.setRequestHeader('Authorization', 'Bearer ' + token); }
        });

      });


    }
    function editThis(id, el) {
      save_method = 'PUT';
      $.ajax({
        url: './app/bill_of_lading/' + id,
        type: 'GET',
        dataType: 'json',
        success: function (data) {
          data_model = data;
          data_model['notify_date'] = formatDate(data['notify_date']);
          loadFormData('#form', data_model);
          $('#modal_form .modal-title').text('Edit Bill Of Lading - '+data.bill_of_lading_number); //+'   '+data.consignee_fname
          $('#modal_form').modal('show');
          $('#consigneetab').tab('show');
          showHideParentBL();
          $('#master_bol_id').val(data_model.master_bol_id);
          loadContainerTable();
          loadBlGoods();
          loadBlCharge();
          if (TALLY_STATUS.booking_status=='Approved') {
            $("#form :input").prop("disabled", true);
          } else {
            $("#form :input").prop("disabled", false);
          }
        },
        beforeSend: function (xhr, settings) { xhr.setRequestHeader('Authorization', 'Bearer ' + token); }
      });
    }
    function newBillOfLading() {
      //data_model = { "id": "0", "parent_bol": "", "bol_total": "", "bill_of_lading_number": "", "port_of_origin": "", "port_of_loading": "", "port_of_discharge": "", "port_of_delivery": "", "currency_id": "", "consignee_name": "", "consignee_address": "", "consignee_phone_num": "", "consignee_id": "", "shipper_name": "", "shipper_address": "", "shipper_phone_num": "", "notify_name": "", "notify_address": "", "notify_date": "", "notify_phone_num": "", "master_bol_id": "", "voyage_id": "" }
      data_model={ "id": "0","parent_bol": "","bol_total": "","bill_of_lading_number": "","port_of_origin": "","port_of_loading": "","port_of_discharge": "","port_of_delivery": "","currency_id": "","consignee_sname": "","consignee_fname": "","consignee_other_name": "","consignee_address": "","consignee_phone_num": "","consignee_id": "","shipper_id": "","shipper_fname": "","shipper_sname": "","shipper_other_name": "","shipper_address": "","shipper_phone_num": "","notify_fname": "","notify_other_name": "","notify_sname": "","notify_address": "","notify_date": "","notify_phone_num": "","master_bol_id": "","booking_id": "","order_processed": "","receipt_processed": "","edited_by": "","edit_type": "","value_of_goods": "","value_currency": "","customer_type": "","status": "","booking_container_id": ""};
      save_method = 'POST';
      clearForm('#form');
      $('#modal_form').modal('show'); // show bootstrap modal                
      showHideParentBL();
      $('#chargestab').hide();
      $('#goodstab').hide();
      $('#containertab').hide();
      $('#consigneetab .modal-title').text('Add Bill Of Lading');
      $('#consigneetab').tab('show');
      initializeWithMaster();
      $("#form :input").prop("disabled", false);
    }

    function initializeWithMaster() {
      var select_path = './app/bill_of_lading/master-select/' + $('#booking').val();
      if (SELECT_DATA_PATH[select_path]) {
        $.each(SELECT_DATA_PATH[select_path], function (key, value) {
          if ($('#master_bol_id').val() == value.id) {
            $('#port_of_loading').val(value.port_of_loading);
            $('#port_of_delivery').val(value.port_of_delivery);
            $('#port_of_origin').val(value.port_of_origin);
            $('#port_of_discharge').val(value.port_of_discharge);
            $('#currency_id').val(value.currency_id);
          }
        });
      }

    }
    function loadBookingSelect() {
      $('#booking').empty();
      var select_path = './app/booking/select/' + $('#vessel').val();
      if (SELECT_DATA_PATH[select_path]) {
        $.each(SELECT_DATA_PATH[select_path], function (key, value) {
          $('#booking').append('<option value=' + value.id + '>' + value.manifest_number + ' - ' + formatDate(value.sail_date) + '</option>');
        });
        loadManifestTable();
      } else {
        $.ajax({
          url: select_path,
          type: 'GET',
          dataType: 'json',
          async: false,
          success: function (data) {
            SELECT_DATA_PATH[select_path] = data;
            $.each(data, function (key, value) {
              $('#booking').append('<option value=' + value.id + '>' + value.manifest_number + ' - ' + formatDate(value.sail_date) + '</option>');
            });
            loadManifestTable();
          },
          error: function (xhr, ajaxOptions, thrownError) { handleStandardHttpErrors(xhr, ajaxOptions, thrownError) },
          beforeSend: function (xhr, settings) { xhr.setRequestHeader('Authorization', 'Bearer ' + token); }
        });
      }
      loadBookingContainerSelect();
    }
    function loadBookingContainerSelect() {
      $('#booking_container').empty();
      $('#booking_container_id').empty();
      var select_path = './app/booking_container/select/' + $('#booking').val();
      if (SELECT_DATA_PATH[select_path]) {
        $.each(SELECT_DATA_PATH[select_path], function (key, value) {
          $('#booking_container').append('<option value=' + value.id + '>' + value.container_number  + '</option>');
          $('#booking_container_id').append('<option value=' + value.id + '>' + value.container_number  + '</option>');
        });
      } else {
        $.ajax({
          url: select_path,
          type: 'GET',
          dataType: 'json',
          async: false,
          success: function (data) {
            SELECT_DATA_PATH[select_path] = data;
            $.each(data, function (key, value) {
              $('#booking_container').append('<option value=' + value.id + '>' + value.container_number  + '</option>');
          $('#booking_container_id').append('<option value=' + value.id + '>' + value.container_number  + '</option>');
            });            
          },
          error: function (xhr, ajaxOptions, thrownError) { handleStandardHttpErrors(xhr, ajaxOptions, thrownError) },
          beforeSend: function (xhr, settings) { xhr.setRequestHeader('Authorization', 'Bearer ' + token); }
        });
      }
      updateStatus();
    }
    function loadParentSelect() {
      $('#master_bol_id').empty();
      var select_path = './app/bill_of_lading/master-select/' + $('#booking').val();
      if (SELECT_DATA_PATH[select_path] && arguments.length == 0) {
        $.each(SELECT_DATA_PATH[select_path], function (key, value) {
          if (data_model.id != value.id) {
            $('#master_bol_id').append('<option value=' + value.id + '>' + value.bill_of_lading_number + '</option>');
          }
        });
      } else {
        $.ajax({
          url: select_path,
          type: 'GET',
          dataType: 'json',
          async: false,
          success: function (data) {
            SELECT_DATA_PATH[select_path] = data;
            $.each(data, function (key, value) {
              if (data_model.id != value.id) {
                $('#master_bol_id').append('<option value=' + value.id + '>' + value.bill_of_lading_number + '</option>');
              }
            });
          },
          error: function (xhr, ajaxOptions, thrownError) { handleStandardHttpErrors(xhr, ajaxOptions, thrownError) },
          beforeSend: function (xhr, settings) { xhr.setRequestHeader('Authorization', 'Bearer ' + token); }
        });
      }
      updateStatus();
    }
    function loadContainerSizeType() {
      var select_path = './app/container_size_type/select';
      var size_type_code = [], obj = {};
      if (SELECT_DATA_PATH[select_path]) {
        $.each(SELECT_DATA_PATH[select_path], function (key, value) {
          obj = {};
          obj['value'] = value.id;
          obj['text'] = value.size_type_code;
          size_type_code.push(obj);
        });
      } else {
        $.ajax({
          url: select_path,
          type: 'GET',
          dataType: 'json',
          async: false,
          success: function (data) {
            SELECT_DATA_PATH[select_path] = data;
            $.each(data, function (key, value) {
              obj = {};
              obj['value'] = value.id;
              obj['text'] = value.size_type_code;
              size_type_code.push(obj);
            });
          },
          error: function (xhr, ajaxOptions, thrownError) { handleStandardHttpErrors(xhr, ajaxOptions, thrownError) },
          beforeSend: function (xhr, settings) { xhr.setRequestHeader('Authorization', 'Bearer ' + token); }
        });
      }
      return size_type_code;
    }
    function loadGoods() {

    }
    function loadManifestTable() {
      loadBookingContainerSelect();
      var select_path = './app/booking/select/' + $('#vessel').val();
      if (SELECT_DATA_PATH[select_path]) {
        var vid=$('#booking').val();
        $.each(SELECT_DATA_PATH[select_path], function (key, value) {
             if(value.id==vid){
              console.log(value.transportation_mode);
               if(value.transportation_mode=='A'){
                  $('#bill_of_lading_number').parent().parent().find( ".control-label" )[0].innerHTML="Air Waybill";
                  $('#master_bol_id').parent().parent().find( ".control-label" )[0].innerHTML="MAWB";
               }else{
                  $('#bill_of_lading_number').parent().parent().find( ".control-label" )[0].innerHTML="Bill Of Lading Number";
                  $('#master_bol_id').parent().parent().find( ".control-label" )[0].innerHTML="Master BL";
               }
             }              
        });
      }    
      $('.loader').show();
      $.ajax({
        url: './app/bill_of_lading/list/' + $('#booking').val(),
        type: 'GET',
        dataType: 'json',
        success: function (data) {
          console.log(data);
          $('#classTable').bootstrapTable("destroy");
          $('#classTable').bootstrapTable({
            uniqueId: 'id',
            columns:[{
                        field: 'id',
                        sortable: true,
                        align: 'left',
                        title: 'id'
                    },
                    {
                        field: 'bill_of_lading_number',
                        sortable: true,       
                        align: 'left',
                        formatter: function (value, row, index) {   
                          console.log(value);                         
                            var val=value;  
                            if(numeric(row.receipt_processed)>0){
                               val ='<span style="color:red">'+val+'</span>';                                                           
                            }
                            return val;
                        }
                    }],
            data: data
          });
          loadParentSelect();
          $('.loader').hide();
        },
        beforeSend: function (xhr, settings) { xhr.setRequestHeader('Authorization', 'Bearer ' + token); }
      });
    }
    function updateHouse(id) {
      if ($('#parent_bol').prop('checked')) {
        var obj = {};
        $.ajax({
          type: "POST",
          url: './app/billoflading/update_house/' + id,
          data: JSON.stringify(obj), // serializes the form's elements.                        
          success: function (data) {
          },
          error: function (xhr, ajaxOptions, thrownError) { handleStandardHttpErrors(xhr, ajaxOptions, thrownError); },
          beforeSend: function (xhr, settings) { xhr.setRequestHeader('Authorization', 'Bearer ' + token); }
        });
      }
    }
    function deleteBOLContainer(id) {
      console.log(id);

      $.ajax({
        type: "DELETE",
        url: './app/bill_of_lading_container/' + id,
        success: function (data) {
          loadContainerTable();
        },
        error: function (xhr, ajaxOptions, thrownError) { handleStandardHttpErrors(xhr, ajaxOptions, thrownError) },
        beforeSend: function (xhr, settings) { xhr.setRequestHeader('Authorization', 'Bearer ' + token); }
      });
    }
    function loadContainerTable() {
      $('#containertable').bootstrapTable("destroy");
      //toggle `popup` / `inline` mode
      $.fn.editable.defaults.mode = 'inline';
      var size_types = loadContainerSizeType();
      console.log('logging size type array');
      console.log(size_types);
      /* $('#containertable').on('editable-save.bs.table', function (field, row, newValue, $el) {
         saveBOLContainerRecord(field, row, newValue, $el);
         console.log(field);
         console.log(row);
         console.log(newValue.container_number + 'oniel charles' + newValue.id);
         console.log(newValue);
         console.log($el);
       });  */

      $.ajax({
        url: './app/bill_of_lading_container/select/' + numeric(data_model['id']),
        type: 'GET',
        dataType: 'json',
        success: function (data) {
          $('#containertable').bootstrapTable({
            idField: 'id',
            columns: [
              [{
                field: 'container_number',
                sortable: true,
                align: 'left',
                title: 'Container',
                editable: {
                  type: 'text',
                  validate: function (value) {
                    value = $.trim(value);
                    if (!value) {
                      return 'This field is required';
                    }
                  },
                  url: function (params) {
                    var obj = {};
                    obj[params.name] = params.value;
                    return saveBOLContainerRecord(obj, params.pk);
                  }

                }
              },
              {
                field: 'container_size_type_id',
                title: 'Size Type',
                editable: {
                  type: 'select',
                  source: size_types,
                  url: function (params) {
                    var obj = {};
                    obj[params.name] = params.value;
                    return saveBOLContainerRecord(obj, params.pk);
                  }
                }
              }, {
                field: 'operate',
                title: ' ',
                align: 'center',
                formatter: operateFormatter
              }]
            ],
            uniqueId: 'id',
            data: data
          });
        },
        beforeSend: function (xhr, settings) { xhr.setRequestHeader('Authorization', 'Bearer ' + token); }
      });
    }
    function operateFormatter(value, row, index) {
      return ['<a class="btn-danger" onclick="deleteBOLContainer(' + row.id + ')" href="#" title="Remove">',
        '<i class="glyphicon glyphicon-remove"></i>',
        '</a>'
      ].join('');
    }
    function addBOLContainer() {
      var obj = { "container_number": "", "billoflading_id": data_model['id'] };
      $.ajax({
        type: "POST",
        url: './app/bill_of_lading_container/',
        data: JSON.stringify(obj),
        success: function (data) {
          loadContainerTable();
        },
        error: function (xhr, ajaxOptions, thrownError) { handleStandardHttpErrors(xhr, ajaxOptions, thrownError) },
        beforeSend: function (xhr, settings) { xhr.setRequestHeader('Authorization', 'Bearer ' + token); }
      });
    }
    function showHideParentBL() {
      $('#containertab').hide();
      if ($('#parent_bol').prop('checked')) {
        $('#masterbl').hide();
        $("#cusstype").hide();
        $('#mastercontainer').show();
        $('#chargestab').hide();
        $('#goodstab').show();
        //$('#consigneetab').hide();
        //$('#shippertab').hide();
        //$('#notifytab').hide();
      } else {
        $('#masterbl').show();
        $("#cusstype").show();
        $('#mastercontainer').hide();
        $('#chargestab').show();
        $('#goodstab').show();
      }
      if (save_method == 'POST') {
        $('#containertab').hide();
        $('#chargestab').hide();
        $('#goodstab').hide();
      }
      loadParentSelect();
    }
    function saveBOLContainerRecord(field_obj, id) {
      console.log('are we getting here');
      var record_saved = false;
      $.ajax({
        type: "PUT",
        url: './app/bill_of_lading_container/' + id,
        data: JSON.stringify(field_obj),
        success: function (data) {
          record_saved = true;
        },
        error: function (xhr, ajaxOptions, thrownError) { handleStandardHttpErrors(xhr, ajaxOptions, thrownError) },
        beforeSend: function (xhr, settings) { xhr.setRequestHeader('Authorization', 'Bearer ' + token); }
      });
      return record_saved;
    }

  </script>
  <script>

    //BL Detail Scripts
    function loadBlGoods() {
      $('#blDetailTable').bootstrapTable("destroy");
      $.ajax({
        url: './app/bill_of_lading_detail/select/' + data_model.id,
        type: 'GET',
        dataType: 'json',
        success: function (data) {
          $('#blDetailTable').bootstrapTable({
            uniqueId: 'id',
            data: data
          });

          try { parent.autoResize('myframe'); } catch (e) { }
        },
        error: function (xhr, ajaxOptions, thrownError) {
          handleStandardHttpErrors(xhr, ajaxOptions, thrownError);
        },
        beforeSend: function (xhr, settings) { xhr.setRequestHeader('Authorization', 'Bearer ' + token); }
      });
    }


    $(document).ready(function () {
      //            
      detail_model = { "id": "0", "billoflading_id": "", "package_type_id": "", "commodity_id": "", "Description_of_goods": "", "number_of_items": "", "weight": "", "measure": "", "weight_unit": "", "measure_unit": "", "width": "", "depth": "", "breath": "", "volume": "" }

      bootstrapTableIndex = 0;
      save_detail_method = '';
      pkey = 'id';

      //&**************************************************

      $('#bl_Detail_form')
        .bootstrapValidator({
          feedbackIcons: {
            valid: 'glyphicon glyphicon-ok',
            invalid: 'glyphicon glyphicon-remove',
            validating: 'glyphicon glyphicon-refresh'
          },
          excluded: [':disabled'],
          fields: {
            billoflading_id: {
              validators: {
                notEmpty: {
                  message: 'Billoflading Id is  required and cannot be empty'
                }
              }
            },
            package_type_id: {
              validators: {
                notEmpty: {
                  message: 'Package Type Id is  required and cannot be empty'
                }
              }
            },
            commodity_id: {
              validators: {
                notEmpty: {
                  message: 'Commodity Id is  required and cannot be empty'
                }
              }
            }
          }
        })
        .on('success.form.bv', function (e) {
          console.log('success.form.bv');
          // If you want to prevent the default handler (bootstrapValidator._onSuccess(e))
          // e.preventDefault();
        })
        .on('success.form.bv', function (e) {
          // Prevent submit form
          e.preventDefault();
          var $form = $(e.target),
            validator = $form.data('bootstrapValidator');
          var form_data = getFormData('#bl_Detail_form', detail_model);
          if (save_detail_method == 'PUT') {
            $.ajax({
              type: "PUT",
              url: './app/bill_of_lading_detail/' + form_data['id'],
              async:false,
              data: JSON.stringify(form_data),
              success: function (data) {
                $('#detail_modal').modal('hide');
                toastr.success('The record was updated successfully', 'Success Alert', { timeOut: 5000 })
                $('#blDetailTable').bootstrapTable('updateByUniqueId', {
                  id: form_data['id'],
                  row: form_data
                });

              },
              error: function (xhr, ajaxOptions, thrownError) {
                handleStandardHttpErrors(xhr, ajaxOptions, thrownError);
              },
              beforeSend: function (xhr, settings) { xhr.setRequestHeader('Authorization', 'Bearer ' + token); }
            });
          }
          if (save_detail_method == 'POST') {
            form_data.id = null;
            $.ajax({
              type: "POST",
              url: './app/bill_of_lading_detail/',
              async:false,
              data: JSON.stringify(form_data),
              success: function (data) {
                console.log('after add -1' + data);
                //var object = $.extend({}, object1, object2);
                var obj = {};
                $.extend(true, obj, form_data);
                obj.id = data;
                obj.actions = '<button onclick="editBlDetail(' + data + ',this)" style="margin-left:10px" class="btn btn-primary btn-sm"   data-target="#edit-button" ><i class="glyphicon glyphicon-edit"></i></button>';
                obj.actions += '<button onclick="deleteBlDetail(' + data + ',this)" style="margin-left:10px" class="btn btn-danger btn-sm"  data-target="#delete-button" ><i class="glyphicon glyphicon-trash"></i></button>';

                console.log(obj);
                $('#detail_modal').modal('hide');
                toastr.success('The record was successfully added', 'Success Alert', { timeOut: 5000 });
                $('#blDetailTable').bootstrapTable("append", obj);
                getBusinessObject('tally_detail/merge',data_model.booking_id);
              },
              error: function (xhr, ajaxOptions, thrownError) {
                handleStandardHttpErrors(xhr, ajaxOptions, thrownError);
              },
              beforeSend: function (xhr, settings) { xhr.setRequestHeader('Authorization', 'Bearer ' + token); }
            });
          }
          updateStatus();
          $form
            .bootstrapValidator('disableSubmitButtons', false)
            .bootstrapValidator('resetForm', true);
        })
        .on('click', 'tbody > tr > td', function (e) {
          var table = $table.data('bootstrap.table'),
            $element = $(this),
            $tr = $element.parent(),
            row = table.data[$tr.data('index')];
          alert(row);
        });

      //**************************************************

      $("#create-detail").click(function (e) {
        //
        detail_model = { "id": "0", "billoflading_id": "", "package_type_id": "", "commodity_id": "", "Description_of_goods": '', "number_of_items": "", "weight": "", "measure": "", "weight_unit": "", "measure_unit": "", "width": "", "depth": "", "breath": "", "volume": "" }
        e.preventDefault();
        clearForm('#bl_Detail_form');
        $('#auto_describe').iCheck('check');
        $('#bl_Detail_form').find('#billoflading_id').val(data_model.id);
        save_detail_method = 'POST';
        $('#detail_modal').modal('show'); // show bootstrap modal                
        $('#detail_modal .modal-title').text('Add Bill Of Lading Detail');
      });


      function getData() {
        return '{"data":[{"id":"1","name":"1 West","location":"Block C"},{"id":"2","name":"1 North","location":"Block A"},{"id":"3","name":"1 South","location":"Block A"}]}';
      }


    });
    function saveRecord() {

    }
    function deleteBlDetail(id, el) {
      bootstrapTableIndex = $(el).closest("tr").index();
      var tmp = $(el).closest("tr").find("td:eq(0)").text();
      confirmDialog("Delete Request", 'Are you sure you want to delete:<br><b>' + tmp + '<b> ?', function (confirm) {
        if (!confirm) return false;
        $.ajax({
          type: "DELETE",
          url: './app/bill_of_lading_detail/' + id,
          success: function (data) {
            console.log('deleted ' + id);
            //$('#blDetailTable').bootstrapTable('remove', { field: 'id', values: ['' + id] });
            $('#blDetailTable').bootstrapTable('removeByUniqueId', id);
            toastr.success('The record was deleted successfully', 'Success Alert', { timeOut: 5000 })

          },
          error: function (xhr, ajaxOptions, thrownError) {
            handleStandardHttpErrors(xhr, ajaxOptions, thrownError);
          },
          beforeSend: function (xhr, settings) { xhr.setRequestHeader('Authorization', 'Bearer ' + token); }
        });

      });


    }
    function editBlDetail(id, el) {
      save_detail_method = 'PUT';
      $.ajax({
        url: './app/bill_of_lading_detail/' + id,
        type: 'GET',
        dataType: 'json',
        success: function (data) {
          $('#bl_Detail_form')
            .bootstrapValidator('disableSubmitButtons', false)
            .bootstrapValidator('resetForm', true);
          detail_model = data;
          loadFormData('#bl_Detail_form', detail_model);
          $('#detail_modal .modal-title').text('Edit Bill Of Lading Detail');
          $('#detail_modal').modal('show');
          $('#auto_describe').iCheck('check');
          if (TALLY_STATUS.booking_status=='Approved') {
            $("#bl_Detail_form :input").prop("disabled", true);
          } else {
            $("#bl_Detail_form :input").prop("disabled", false);
          }
        },
        error: function (xhr, ajaxOptions, thrownError) {
          handleStandardHttpErrors(xhr, ajaxOptions, thrownError);
        },
        beforeSend: function (xhr, settings) { xhr.setRequestHeader('Authorization', 'Bearer ' + token); }
      });
    }
    function autoDescribeGoods() {
      console.log($('#auto_describe').prop('checked'));
      if ($('#auto_describe').prop('checked') || (arguments.length > 0 && !$('#auto_describe').prop('checked'))) {
        var txt = $('#number_of_items').val() + ' ' + $('#package_type_id option:selected').text() + '(s) said to contain ' + $('#commodity_id option:selected').text();
        $('#Description_of_goods').val(txt);
      }
    }

    function createActionButtons(value, row, index, field) {
      var $buttons = '<button onclick="editBlDetail(' + row.id + ',this); return false;" style="margin-left:10px" class="btn btn-primary btn-sm"   data-target="#edit-button" ><i class="glyphicon glyphicon-edit"></i></button>';
      if (TALLY_STATUS.booking_status!='Approved') {
        $buttons += '<button onclick="deleteBlDetail(' + row.id + ',this); return false;" style="margin-left:10px" class="btn btn-danger btn-sm"  data-target="#delete-button" ><i class="glyphicon glyphicon-trash"></i></button>';
      }
      return $buttons;
    }
    function createBlActionButtons(value, row, index, field) {
      var $buttons = '<button onclick="printThis(' + row.id + ',this); return false;" style="margin-left:10px" class="btn btn-default btn-sm"   data-target="#print-button" ><i class="fa fa-print"></i></button>';
      $buttons += '<button onclick="editThis(' + row.id + ',this); return false;" style="margin-left:10px" class="btn btn-primary btn-sm"   data-target="#editbl-button" ><i class="glyphicon glyphicon-edit"></i></button>';
      $buttons += '<button onclick="deleteThis(' + row.id + ',this); return false;" style="margin-left:10px" class="btn btn-danger btn-sm"  data-target="#deletebl-button" ><i class="glyphicon glyphicon-trash"></i></button>';
      return $buttons;
    }
  </script>
  <script>
    /*CHARGES Script
    rename for integration
    charge_model
    charge_form
    charge_modal
    create-charge-rec
    chargeTable
    */

    function loadBlCharge() {
      $('#chargeTable').bootstrapTable("destroy");
      $.ajax({
        url: './app/bill_of_lading_other_charge/select/' + data_model.id,
        type: 'GET',
        dataType: 'json',
        success: function (data) {
          $('#chargeTable').bootstrapTable({
           // height: 300,
            uniqueId: 'id',
            data: data
          });
        },
        error: function (xhr, ajaxOptions, thrownError) {
          handleStandardHttpErrors(xhr, ajaxOptions, thrownError);
        },
        beforeSend: function (xhr, settings) { xhr.setRequestHeader('Authorization', 'Bearer ' + token); }
      });
    }

    function formatPrepaid(value, row, index, field) {
      return $("#prepaid_flag [value='" + value + "']").text();
    }
   function formatBalance(value, row, index, field) {
    return  numericStr(row.amount-row.amount_paid,2);
    }
    function formatChargeItem(value, row, index, field) {

      var select_path = "./app/charge_item/select";
      if (!SELECT_DATA_PATH[select_path]) {
        $.ajax({
          url: select_path,
          type: 'GET',
          dataType: 'json',
          async: false,
          success: function (data) {
            SELECT_DATA_PATH[select_path] = data;
          },
          error: function (xhr, ajaxOptions, thrownError) { handleStandardHttpErrors(xhr, ajaxOptions, thrownError) },
          beforeSend: function (xhr, settings) { xhr.setRequestHeader('Authorization', 'Bearer ' + token); }
        });
      }
      var txt = ''
      for (var i = 0; i < SELECT_DATA_PATH[select_path].length; i++) {
        if (SELECT_DATA_PATH[select_path][i].id == value) { txt = SELECT_DATA_PATH[select_path][i].description; }
      }
      return txt;
    }

    $(document).ready(function () {
      //
      charge_model = { "id": "0","charge_item_id": "","amount": "","prepaid_flag": "","attract_gct": "","currency_id": "","billoflading_id": "","amount_paid": ""};

      bootstrapTableIndex = 0;
      save_method = '';
      pkey = 'id';

      //&**************************************************

      $('#charge_form')
        .bootstrapValidator({
          feedbackIcons: {
            valid: 'glyphicon glyphicon-ok',
            invalid: 'glyphicon glyphicon-remove',
            validating: 'glyphicon glyphicon-refresh'
          },
          excluded: [':disabled'],
          fields: {
            charge_item_id: {
              validators: {
                notEmpty: {
                  message: 'Charge Item Id is  required and cannot be empty'
                }
              }
            },
            amount: {
              validators: {
                notEmpty: {
                  message: 'Amount is  required and cannot be empty'
                }
              }
            }
          }
        })
        .on('success.form.bv', function (e) {
          console.log('success.form.bv');
          // If you want to prevent the default handler (bootstrapValidator._onSuccess(e))
          // e.preventDefault();
        })
        .on('success.form.bv', function (e) {
          // Prevent submit form
          e.preventDefault();
          var $form = $(e.target),
            validator = $form.data('bootstrapValidator');
          var form_data = getFormData('#charge_form', charge_model);
          if (charge_save_method == 'PUT') {
            $.ajax({
              type: "PUT",
              url: './app/bill_of_lading_other_charge/' + form_data['id'],
              data: JSON.stringify(form_data),
              success: function (data) {
                $('#charge_modal').modal('hide');
                toastr.success('The record was updated successfully', 'Success Alert', { timeOut: 5000 })
                $('#chargeTable').bootstrapTable('updateByUniqueId', {
                  id: form_data['id'],
                  row: form_data
                });

              },
              error: function (xhr, ajaxOptions, thrownError) {
                handleStandardHttpErrors(xhr, ajaxOptions, thrownError);
              },
              beforeSend: function (xhr, settings) { xhr.setRequestHeader('Authorization', 'Bearer ' + token); }
            });
          }
          if (charge_save_method == 'POST') {
            form_data.id = null;
            $.ajax({
              type: "POST",
              url: './app/bill_of_lading_other_charge/',
              data: JSON.stringify(form_data),
              success: function (data) {
                save_method = 'PUT';
                var obj = {};
                $.extend(true, obj, form_data);
                obj.id = data;
                $('#charge_modal').modal('hide');
                toastr.success('The record was successfully added', 'Success Alert', { timeOut: 5000 });
                $('#chargeTable').bootstrapTable("append", obj);

              },
              error: function (xhr, ajaxOptions, thrownError) {
                handleStandardHttpErrors(xhr, ajaxOptions, thrownError);
              },
              beforeSend: function (xhr, settings) { xhr.setRequestHeader('Authorization', 'Bearer ' + token); }
            });
          }
          $form
            .bootstrapValidator('disableSubmitButtons', false)
            .bootstrapValidator('resetForm', true);
        })
        .on('click', 'tbody > tr > td', function (e) {
          var table = $table.data('bootstrap.table'),
            $element = $(this),
            $tr = $element.parent(),
            row = table.data[$tr.data('index')];
          alert(row);
        });


      $("#create-charge-rec").click(function (e) {
        charge_save_method = 'POST';
        charge_model = { "id": "0","charge_item_id": "","amount": "","prepaid_flag": "","attract_gct": "","currency_id": "","billoflading_id": "","amount_paid": ""};
        e.preventDefault();
        clearForm('#charge_form');
        $('#charge_form #billoflading_id').val(data_model.id);
        $('#charge_modal').modal('show');
        $('#charge_modal .modal-title').text('Add Bill Of Lading Other Charge');
        initialLizeAmount();
      });


      function getData() {
        return '{"data":[{"id":"1","name":"1 West","location":"Block C"},{"id":"2","name":"1 North","location":"Block A"},{"id":"3","name":"1 South","location":"Block A"}]}';
      }


    });
    function saveRecord() {

    }
    function deleteCharge(id, el) {
      bootstrapTableIndex = $(el).closest("tr").index();
      var tmp = $(el).closest("tr").find("td:eq(0)").text();
      confirmDialog("Delete Request", 'Are you sure you want to delete:<br><b>' + tmp + '<b> ?', function (confirm) {
        if (!confirm) return false;
        $.ajax({
          type: "DELETE",
          url: './app/bill_of_lading_other_charge/' + id,
          success: function (data) {
            console.log('deleted ' + id);
            //$('#chargeTable').bootstrapTable('remove', { field: 'id', values: ['' + id] });
            $('#chargeTable').bootstrapTable('removeByUniqueId', id);
            toastr.success('The record was deleted successfully', 'Success Alert', { timeOut: 5000 })

          },
          error: function (xhr, ajaxOptions, thrownError) {
            handleStandardHttpErrors(xhr, ajaxOptions, thrownError);
          },
          beforeSend: function (xhr, settings) { xhr.setRequestHeader('Authorization', 'Bearer ' + token); }
        });

      });


    }
    function editCharge(id, el) {
      bootstrapTableIndex = $(el).closest("tr").index();
      charge_save_method = 'PUT';
      $.ajax({
        url: './app/bill_of_lading_other_charge/' + id,
        type: 'GET',
        dataType: 'json',
        success: function (data) {
          $('#charge_form')
            .bootstrapValidator('disableSubmitButtons', false)
            .bootstrapValidator('resetForm', true);
          charge_model = data;
          loadFormData('#charge_form', charge_model);
          $('#charge_modal .modal-title').text('Edit Bill Of Lading Other Charge');
          $('#charge_modal').modal('show');
          if (TALLY_STATUS.booking_status=='Approved') {
            $("#charge_form :input").prop("disabled", true);
          } else {
            $("#charge_form :input").prop("disabled", false);
          }
        },
        error: function (xhr, ajaxOptions, thrownError) {
          handleStandardHttpErrors(xhr, ajaxOptions, thrownError);
        },
        beforeSend: function (xhr, settings) { xhr.setRequestHeader('Authorization', 'Bearer ' + token); }
      });
    }
    function createChargeActionButtons(value, row, index, field) {
      var $buttons = '<button onclick="editCharge(' + row.id + ',this); return false;" style="margin-left:10px" class="btn btn-primary btn-sm"   data-target="#edit-button" ><i class="glyphicon glyphicon-edit"></i></button>';
      if (TALLY_STATUS.booking_status!='Approved') {
        $buttons += '<button onclick="deleteCharge(' + row.id + ',this); return false;" style="margin-left:10px" class="btn btn-danger btn-sm"  data-target="#delete-button" ><i class="glyphicon glyphicon-trash"></i></button>';
      }
      return $buttons;
    }

    function printManifest(){
      showLargeReport('./app/report/bol_manifest_fmt1/' +$('#booking').val() , 'Manifest.pdf', 'Manifest', '#my-report1-iframe', {});
      $('#report2-tab').hide();
    }
    function printManifestCharges(){
      showLargeReport('./app/report/manifest_charge_list/' +$('#booking').val() , 'Charge_list.pdf', 'Freight List', '#my-report1-iframe', {});
      $('#report2-tab').hide();
    }
    function printChargesManifest(){
      showLargeReport('./app/report/bol_manifest/' +$('#booking').val() , 'Manifest.pdf', 'Charges Manifest', '#my-report1-iframe', {});
      $('#report2-tab').hide();
    }
    
    function initializeConsignee(){
        var path='./app/client/select';        
        $("#consignee_fname").val("");
        $("#consignee_sname").val("");
        $("#consignee_address").val("");
        $("#consignee_phone_num").val("");
        if(SELECT_DATA_PATH[path]){
            $.each(SELECT_DATA_PATH[path], function (key, value) {            
                if ($("#consignee_id").val()==value.id) {
                    $("#consignee_fname").val(value.client_fname);
                    $("#consignee_sname").val(value.client_sname);
                    $("#consignee_address").val(value.client_address);
                    $("#consignee_phone_num").val(value.phone_number);
                }
            });  
        } 
     }
     function initializeShipper(){
        var path='./app/client/select';        
        $("#shipper_fname").val("");
        $("#shipper_sname").val("");
        $("#shipper_address").val("");
        $("#shipper_phone_num").val("");
        if(SELECT_DATA_PATH[path]){
            $.each(SELECT_DATA_PATH[path], function (key, value) {            
                if ($("#shipper_id").val()==value.id) {
                    $("#shipper_fname").val(value.client_fname);
                    $("#shipper_sname").val(value.client_sname);
                    $("#shipper_address").val(value.client_address);
                    $("#shipper_phone_num").val(value.phone_number);
                }
            });  
        } 
     }

     function updateStatus(){
      $(".cube-count").removeClass("bg-danger");
      $("#container_size_description").html("");
      $("#container_size").html("");
      var select_path = './app/booking_container/select/' + $('#booking').val();
      var max_cube=0;
      if (SELECT_DATA_PATH[select_path]) {
        $.each(SELECT_DATA_PATH[select_path], function (key, value) {
          if($('#booking_container').val()==value.id){
            console.log(value.description);
              $("#container_size_description").html(value.description);
              $("#container_size").html(value.maximum_cude);
              max_cube=value.maximum_cude;
          }          
        });
      }
      $("#number_of_pieces").html('0');
      $("#container_space").html(numericStr(max_cube,2));
      var obj=getBusinessObject('bill_of_lading_detail/summary',numeric($('#booking').val()));
      if(obj.length>0){
        $("#number_of_pieces").html(numeric(obj[0].number_of_items));
        var cubes=numeric(numeric(max_cube)-numeric(obj[0].measure));
        if(cubes<0){
          $(".cube-count").addClass("bg-danger");
          toastr.error('Container capacity has been exceeded please remove some of the bills of lading ' , 'Error Alert', { timeOut: 5000 });
        }
        $("#container_space").html(numericStr(cubes,2) );
      }
      //tally_status
     
      TALLY_STATUS={end_date:0};
      var obj=getBusinessObject('tally/status',numeric($('#booking').val()));          
        if(obj.length!=0 && numeric(obj[0].start_date)!=0){  
          TALLY_STATUS=obj[0];
          $("#tally_status").html("Started on "+formatDate(obj[0].start_date)+" / <b style='color:red'>"+obj[0].number_of_items+"</b> Tallied" );
          if(numeric(obj[0].end_date) >0){ 
             $("#tally_status").html("Ended on "+formatDate(obj[0].end_date)+" / <b style='color:red'>"+obj[0].number_of_items+"</b> Tallied" );
          }  
        } else{
          $("#tally_status").html("Not Started" );
        } 
     }

      function getRowWithId(id) {
            var tab = $('#classTable');
            var obj = {};            
            var rows= tab.bootstrapTable('getData');
            $.each(rows,function(ind,value){
                if(id==value.id){
                  obj=value;
                }
            });
            return obj;
      }

      function viewTallyResults(){
        $('#tally_modal').modal('show');
        tally_result=getBusinessObject('tally/tally_result',$("#booking").val());
        showHideTallyErrors();
      }

      function getPackageDescription(id){
        var select_path='./app/package/select',desc='';
        if (SELECT_DATA_PATH[select_path]) {   
          $.each(SELECT_DATA_PATH[select_path], function (key, value) {
          if(id==value.id){
             desc=value.description;
             return;
          }          
        });    
        }
        return desc;
      } 
      function showHideTallyErrors(){
          console.log('show hide tally');
          var error_count=0;
           var data=tally_result.filter( (row,index) =>{
             if((row.b_num!=row.t_num || row.t_package!=row.b_package)) {++error_count;}
             if (!$('#show_tally_errors').prop('checked')) {return true;}
             
              if ($('#show_tally_errors').prop('checked') && (row.b_num!=row.t_num || row.t_package!=row.b_package)){
                console.log(row);
                return true;
              }else
                 return false; 

            });
            var status='';
            if(TALLY_STATUS.end_date==0) {status=' (Tally Not Complated)'}
            if (error_count>0){
              $("#tally_error_count").html("<b class='red'>"+error_count+" Errors Found </b>"+status);
            }else{
              $("#tally_error_count").html("<b class='blue'>"+error_count+" Errors Found </b>"+status);
            }
           $('#tallyResultTable').bootstrapTable("destroy");
        $('#tallyResultTable').bootstrapTable({
            idField: 'bill_of_lading_number',
            columns: [
              [ {
                field: 'operate',
                title: ' <i class="fa fa-check-square blue" style="font-size:20px" ></i>',
                align: 'center',
                formatter: function(value,row,index){
                    if(row.b_num==row.t_num && row.t_package==row.b_package){
                      return '<i class="fa fa-check green" style="font-size:25px" ></i>';
                    }else{   
                      return '<i class="fa fa-ban red" style="font-size:25px" ></i>';
                    }
                }
              },
              {
                field: 'bill_of_lading_number',
                align: 'left',
                title: 'Bill No'
              },
              {
                field: 'b_package',
                align: 'left',
                title: 'Package on BL',
                formatter: function(value, row, index) {                      
                    return  getPackageDescription(value); 
                }  
                
              },
              {
                field: 'b_num',
                align: 'center',
                title: 'Amount on BL'
              },
              {
                field: 't_num',
                align: 'center',
                title: 'Tally Amount'
              },
              {
                field: 't_package',
                align: 'left',
                title: 'Package Tallied',
                formatter: function(value, row, index) {
                    return getPackageDescription(value);
                }   
              }]
            ],
            uniqueId: 'bill_of_lading_number',
            data: data
          });
      }      
       
  </script>
</body>

</html>